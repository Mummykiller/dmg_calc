// Toon Transcribing Object Oriented Notation for DDO Damage Calculator

@App: DDO_Damage_Calculator
  Description: A web application for calculating and comparing average damage per hit in the game Dungeons & Dragons Online (DDO). It allows for multiple equipment/stat sets to be configured and analyzed.

  @Component: UIManager
    Description: Manages the overall user interface, including the main layout, navigation, and modals.
    - PageWrapper: The main container for all visible elements.
      - TitleWrapper
        - AppTitle: "DDO Damage Calculator"
        - ThemeToggle -> toggleTheme()
          - Manages light and dark mode preferences via localStorage.
      - SetNavigation
        - AddSetButton -> CalculatorManager.addNewSet()
        - ImportButton -> CalculatorManager.showImportModal()
        - ExportButton -> CalculatorManager.showExportModal()
        - NavTabs[]: A collection of tabs, one for each Calculator set.
          - Tab -> CalculatorManager.switchToSet()
          - TabName (Editable) -> CalculatorManager.recordAction('RENAME')
          - CloseButton -> CalculatorManager.removeSet()
      - CalculatorWrapper
        - Contains a list of `CalculatorSet` components.
      - ComparisonContainer
        - ComparisonTable: Displays a summary of all active sets.
          -> CalculatorManager.updateComparisonTable()

  @Component: CalculatorSet
    Description: Represents a single instance of the damage calculator UI for one equipment set. Cloned from a central HTML <template>.
    - InputColumn: Contains all user-configurable stats.
      - StatsGroup (Multiple): Groups related inputs (e.g., Base Damage, Critical Profile).
        - WeaponDamageInput (Text, supports dice notation)
        - BonusBaseDamageInput (Number)
        - CritThreatInput (Text)
        - CritMultiplierInput (Number)
        - MeleePowerInput (Number)
        - SneakAttackDiceInput (Number)
        - ImbueDiceInput (Number)
        - UnscaledDamageRows[]: Dynamically added/removed rows for special damage sources.
          - Damage (Text, supports dice notation)
          - ProcChance (Number)
          - MultiStrike (Checkbox)
          - OnCrit (Checkbox)
          - RemoveButton -> removes the row.
    - ResultsColumn: Displays the calculated output for this set.
      - SummaryResults: Shows total average damage and its main components.
      - ScalingBreakdown: Shows intermediate calculation steps.
      - RollResultsTable: A detailed table showing the final damage for every possible d20 roll (1-20).

  @Logic: CalculatorManager (Class)
    Description: The central controller of the application. Manages all `Calculator` instances and application-level state.
    - Properties
      - calculators: Map<setId, Calculator>
      - activeSetId: Number
      - undoStack[]: Array of user actions for the undo feature.
      - redoStack[]: Array of undone actions for the redo feature.
    - Methods
      -> constructor()
        - Initializes the UI and attempts to load a saved state from sessionStorage.
      -> addNewSet(setId?): Creates a new `Calculator` instance and its corresponding UI tab.
      -> removeSet(setId): Deletes a `Calculator` instance and its UI.
      -> switchToSet(setId): Changes the currently visible calculator set.
      -> saveState(): Serializes the state of all sets to sessionStorage.
      -> loadState(): Deserializes state from sessionStorage to restore the application.
      -> recordAction(action): Pushes a user action onto the undoStack.
      -> undo() / redo(): Manages state changes for undo/redo functionality.
      -> updateComparisonTable(): Recalculates and redraws the main comparison table.
      -> showImportModal() / showExportModal(): Manages the UI for importing/exporting set data.

  @Logic: Calculator (Class)
    Description: Represents the logic for a single calculator set. Handles all calculations and UI updates for its specific set.
    - Properties
      - setId: Number
      - totalAverageDamage: Number
      - (References to all its DOM input/output elements)
    - Methods
      -> calculateDdoDamage(): The core calculation loop. Gathers inputs, calculates probabilities and damage portions, and updates the UI.
      -> _getInputs(): Gathers and parses all values from the DOM.
      -> parseDiceNotation(string): Converts dice strings like "2d6+5" into an average numerical value.
      -> _calculateProbabilities(): Determines the chance of a miss, graze, hit, or crit.
      -> updateRollDamageTable(): Populates the per-roll breakdown table.
      -> getState() / setState(state): Serializes/deserializes the state for a single calculator instance.
      -> addEventListeners(): Sets up all input listeners, including the 'blur' event to default empty fields to '0'.

  @Feature: StatePersistence
    - Uses `sessionStorage` to automatically save and load the entire application state, including all sets, their values, and their order.

  @Feature: ImportExport
    - Exports all sets to a JSON string for backup or sharing.
    - Exports a human-readable `.txt` summary.
    - Imports sets from a valid JSON file or text paste.